# MCP RAG Server 사용 가이드

## 개요
MCP (Model Context Protocol) RAG Server는 위키피디아 문서 기반의 질문 답변 시스템입니다. 사용자의 질문에 대해 관련 파일을 찾고, 해당 파일에서 적합한 내용을 추출해주는 두 가지 주요 기능을 제공합니다.

## 주요 기능

### 1. `search_files` - 파일 검색
- **목적**: 사용자 질문에 대해 파일제목을 보고 적합한 파일 2~3개 선택
- **입력**: 
  - `query` (str): 사용자의 질문이나 검색어
  - `max_results` (int, 선택): 반환할 최대 파일 수 (기본값: 3)
- **출력**: 관련성 점수와 함께 정렬된 파일 목록

### 2. `get_relevant_content` - 내용 추출
- **목적**: 특정 파일에서 질문과 관련된 내용을 추출
- **입력**:
  - `file_title` (str): 파일 제목 (확장자 제외)
  - `query` (str): 사용자의 질문
  - `max_lines` (int, 선택): 추출할 최대 줄 수 (기본값: 50)
- **출력**: 질문과 관련된 파일 내용

## 설치 및 설정

### 1. 의존성 설치
```bash
# 프로젝트 루트에서 전체 의존성 설치
pip install -r requirements.txt

# 또는 MCP 서버만 실행하려면
cd mcp-server
pip install -r requirements.txt
```

### 2. 데이터 준비
프로젝트 루트의 `data/raw/` 폴더에 마크다운(.md) 또는 텍스트(.txt) 파일들을 저장하세요.

예시 구조:
```
mcp-rag-test/
├── data/raw/
│   ├── 인공지능.md
│   ├── 기계 학습.md
│   ├── 딥 러닝.md
│   └── ...
└── mcp-server/
    ├── mcp_rag_server.py
    ├── test_mcp_server.py
    └── ...
```

### 3. 서버 실행
```bash
cd mcp-server
python mcp_rag_server.py
```

## MCP 클라이언트 연결

### Claude Desktop 연결
1. Claude Desktop 설정 파일 (`claude_desktop_config.json`)에 다음 추가:
```json
{
  "mcpServers": {
    "rag-server": {
      "command": "python",
      "args": ["mcp_rag_server.py"],
      "cwd": "/path/to/your/project/mcp-server"
    }
  }
}
```

2. Claude Desktop 재시작

### 다른 MCP 클라이언트
제공된 `mcp_config.json` 파일을 참조하여 설정하세요.

## 사용 예시

### 파일 검색
```
사용자: "딥러닝에 대해 알고 싶어"
결과: 
- 딥 러닝.md (관련성: 0.95)
- 합성곱 신경망.md (관련성: 0.67)
- 순환 신경망.md (관련성: 0.45)
```

### 내용 추출
```
사용자: get_relevant_content("딥 러닝", "신경망의 종류")
결과: 딥러닝 문서에서 신경망 종류와 관련된 섹션 내용 반환
```

## 주요 특징

### 지능적 파일 매칭
- 정확한 키워드 매칭
- 부분 문자열 매칭
- AI/ML 도메인 특화 키워드 인식
- 가중치 기반 관련성 점수 계산

### 스마트 내용 추출
- YAML 메타데이터 자동 제거
- 키워드 주변 맥락 포함
- 헤더와 중요 섹션 우선 추출
- 적응형 내용 길이 조절

### 견고한 에러 처리
- 파일 없음 처리
- 인코딩 오류 처리
- 로깅을 통한 디버깅 지원

## 기술적 세부사항

### 지원 파일 형식
- Markdown (.md)
- 텍스트 (.txt)

### 관련성 점수 알고리즘
1. **정확 매칭** (0.8점): 제목이 질문에 포함되거나 반대
2. **단어 매칭** (0.6점): 공통 단어 비율
3. **도메인 키워드** (0.3점): AI/ML 관련 키워드 매칭

### 내용 추출 알고리즘
1. 키워드가 포함된 줄 찾기
2. 주변 맥락 2줄 위, 8줄 아래 포함
3. 최대 줄 수 제한
4. 관련 내용 없을 시 파일 시작 부분 반환

## 문제 해결

### 문서가 검색되지 않는 경우
1. 프로젝트 루트의 `data/raw/` 폴더에 파일이 있는지 확인
2. 파일 확장자가 .md 또는 .txt인지 확인
3. 파일명이 질문과 관련성이 있는지 확인

### 내용이 부정확한 경우
1. `max_lines` 파라미터 조정
2. 더 구체적인 질문 사용
3. 파일 내용에 해당 정보가 실제로 있는지 확인

### 서버 연결 문제
1. Python 경로가 올바른지 확인
2. 의존성이 모두 설치되었는지 확인
3. 로그 메시지 확인

## 라이센스
MIT License 